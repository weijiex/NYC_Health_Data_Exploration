<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>NYC Health Data Exploration</title>
        <script src="https://d3js.org/d3.v4.js"></script>
        <script src="https://d3js.org/topojson.v1.min.js"></script>
        <link rel="stylesheet" href="style.css">
    </head>
  
  <body>
    
    <script>
    var margin = {top: 20, right: 20, bottom: 30, left: 50},
        width = 960 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;
    
    var svg = d3.select("body").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");
    
    //Define quantize scale to sort data values into buckets of color
    var color = d3.scaleQuantize()
                .range(["rgb(237,248,233)","rgb(186,228,179)","rgb(116,196,118)","rgb(49,163,84)","rgb(0,109,44)"]);
    

    d3.csv("map_small_data.csv", function(data) {

        data.forEach(function(d) {
            d.id = +d.id;
        });

        console.log(data)

        //Set input domain for color scale
        color.domain([
          d3.min(data, function(d) { return d.number; }), 
          d3.max(data, function(d) { return d.number; })
        ]);

      d3.json('UHF42.json', function(error, json) {

          console.log(json)

          //Merge the csv data and GeoJSON
          //Loop through once for each csv data value
          //if (error) throw error;
          for (var i = 0; i < data.length; i++) {
        
            //Grab state name
            var dataGeo = data[i].id;
            
            //Grab data value, and convert from string to float
            var dataValue = parseFloat(data[i].number);

            //Find the corresponding geo inside the GeoJSON
            for (var j = 0; j < json.features.length; j++) {
            
              var jsonGeo = json.features[j].properties.GEOCODE;
        
              if (dataGeo == jsonGeo) {
            
                //Copy the data value into the JSON
                json.features[j].properties.value = dataValue;
                
                //Stop looking through the JSON
                break;
                
              }
            }   
          }

          //Bind data and create one path per GeoJSON feature
            var path = d3.geoPath()
            .projection(d3.geoConicConformal()
            .parallels([33, 45])
            .rotate([96, -39])
            .fitSize([width, height], json)); 
         

            var g = svg.append("g");

            g.append('g')
                .selectAll('path')
                .data(json.features)
                .enter()
                .append('path')
                .attr('d', path)
                .style("fill", function(d) {
                        //Get data value
                        var value = d.properties.value;
                        
                        if (value) {
                          //If value exists…
                          return color(value);
                        } else {
                          //If value is undefined…
                          return "#ccc";
                        }
             });
      
        });

    })


    </script>
  </body>
  
</html>
















